"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[765,3146],{10765:(e,a,t)=>{t.d(a,{save:()=>g,saveAs:()=>O});var n=t(18690),r=(t(50076),t(97924)),i=t(13096),o=t(11668),l=t(31933),s=t(62487),c=t(72945);const d="Feature Service",u="feature-layer-utils",y="".concat(u,"-save"),f="".concat(u,"-save-as");"".concat(u,"-saveall"),"".concat(u,"-saveall-as");function p(e){return{isValid:(0,l.W_)(e)&&("feature"!==e.type||!e.dynamicDataSource),errorMessage:"Feature layer should be a layer or table in a map or feature service"}}function m(e){const a=[],t=[];for(const{layer:n,layerJSON:r}of e)n.isTable?t.push(r):a.push(r);return{layers:a,tables:t}}function w(e){return m([e])}async function h(e,a){return/\/\d+\/?$/.test(e.url)?w(a[0]):v(a,e)}async function v(e,a){if(e.reverse(),!a)return m(e);const t=await async function(e,a){let t=await e.fetchData("json");if(function(e){return!!(e&&Array.isArray(e.layers)&&Array.isArray(e.tables))}(t))return t;t||(t={}),function(e){e.layers||(e.layers=[]),e.tables||(e.tables=[])}(t);const{layer:{url:n,customParameters:r,apiKey:i}}=a[0];return await async function(e,a,t){const{url:n,customParameters:r,apiKey:i}=a,{serviceJSON:l,layersJSON:c}=await(0,o.Q)(n,{customParameters:r,apiKey:i}),d=S(e.layers,l.layers,t),u=S(e.tables,l.tables,t);e.layers=d.itemResources,e.tables=u.itemResources;const y=[...d.added,...u.added],f=c?[...c.layers,...c.tables]:[];await async function(e,a,t,n){const r=await async function(e){const a=[];e.forEach((e=>{let{type:t}=e;const n=(0,o.K)(t),r=s.S[n];a.push(r())}));const t=await Promise.all(a),n=new Map;return e.forEach(((e,a)=>{let{type:r}=e;n.set(r,t[a])})),n}(a),i=a.map((e=>{let{id:a,type:i}=e;return new(r.get(i))({url:t,layerId:a,sourceJSON:n.find((e=>{let{id:t}=e;return t===a}))})}));await Promise.allSettled(i.map((e=>e.load()))),i.forEach((a=>{const{layerId:t,loaded:n,defaultPopupTemplate:r}=a;if(!n||null==r)return;const i={id:t,popupInfo:r.toJSON()};"ArcGISFeatureLayer"!==a.operationalLayerType&&(i.layerType=a.operationalLayerType),I(a,i,e)}))}(e,y,n,f)}(t,{url:null!==n&&void 0!==n?n:"",customParameters:r,apiKey:i},a.map((e=>e.layer.layerId))),t}(a,e);for(const n of e)I(n.layer,n.layerJSON,t);return function(e,a){const t=[],n=[];for(const{layer:r}of a){const{isTable:e,layerId:a}=r;e?n.push(a):t.push(a)}b(e.layers,t),b(e.tables,n)}(t,e),t}function b(e,a){if(e.length<2)return;const t=[];for(const{id:n}of e)t.push(n);(0,n.aI)(t.sort(L),a.slice().sort(L))&&e.sort(((e,t)=>{const n=a.indexOf(e.id),r=a.indexOf(t.id);return n<r?-1:n>r?1:0}))}function L(e,a){return e<a?-1:e>a?1:0}function S(e,a,t){const r=(0,n.iv)(e,a,((e,a)=>e.id===a.id));e=e.filter((e=>!r.removed.some((a=>a.id===e.id))));const i=r.added;return i.forEach((a=>{let{id:t}=a;e.push({id:t})})),{itemResources:e,added:i.filter((e=>{let{id:a}=e;return!t.includes(a)}))}}function I(e,a,t){e.isTable?P(t.tables,a):P(t.layers,a)}function P(e,a){const t=e.findIndex((e=>{let{id:t}=e;return t===a.id}));-1===t?e.push(a):e[t]=a}async function T(e,a){var t;const{url:n,layerId:r,title:o,fullExtent:l,isTable:s}=e,d=(0,i.qg)(n);a.url=null!==(t="FeatureServer"===(null===d||void 0===d?void 0:d.serverType)?n:"".concat(n,"/").concat(r))&&void 0!==t?t:null,a.title||(a.title=o),a.extent=null,s||null==l||(a.extent=await(0,c.sQ)(l)),(0,c.OM)(a,c.mm.METADATA),(0,c.OM)(a,c.mm.MULTI_LAYER),(0,c.LG)(a,c.mm.SINGLE_LAYER),s&&(0,c.LG)(a,c.mm.TABLE)}async function g(e,a){return(0,r.UN)({layer:e,itemType:d,validateLayer:p,createItemData:(e,a)=>h(a,[e]),errorNamePrefix:y},a)}async function O(e,a,t){return(0,r.Uh)({layer:e,itemType:d,validateLayer:p,createItemData:(e,a)=>Promise.resolve(w(e)),errorNamePrefix:f,newItem:a,setItemProperties:T},t)}},97924:(e,a,t)=>{t.d(a,{UN:()=>b,Uh:()=>L});var n=t(50076),r=t(37888),i=t(65308),o=t(70652),l=t(79942),s=t(72945),c=t(65526),d=t(24907);async function u(e){const{layer:a,errorNamePrefix:t,validateLayer:r}=e;await a.load(),function(e,a,t){const r=t(e);if(!r.isValid)throw new n.A("".concat(a,":invalid-parameters"),r.errorMessage,{layer:e})}(a,t,r)}function y(e,a){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(a)}function f(e){const{item:a,errorNamePrefix:t,layer:r,validateItem:i}=e;if((0,c.X)(a),function(e){const{item:a,itemType:t,additionalItemType:r,errorNamePrefix:i,layer:o}=e,l=[t];if(r&&l.push(r),!l.includes(a.type)){const e=l.map((e=>"'".concat(e,"'"))).join(", ");throw new n.A("".concat(i,":portal-item-wrong-type"),'Portal item type should be one of: "'.concat(e,'"'),{item:a,layer:o})}}(e),i){const e=i(a);if(!e.isValid)throw new n.A("".concat(t,":invalid-parameters"),e.errorMessage,{layer:r})}}function p(e){const{layer:a,errorNamePrefix:t}=e,{portalItem:r}=a;if(!r)throw new n.A("".concat(t,":portal-item-not-set"),y(a,"requires the portalItem property to be set"));if(!r.loaded)throw new n.A("".concat(t,":portal-item-not-loaded"),y(a,"cannot be saved to a portal item that does not exist or is inaccessible"));f({...e,item:r})}function m(e){var a,t,n,r;const{newItem:l,itemType:s}=e;let c=o.default.from(l);return c.id&&(c=c.clone(),c.id=null),null!==(t=(a=c).type)&&void 0!==t||(a.type=s),null!==(r=(n=c).portal)&&void 0!==r||(n.portal=i.A.getDefault()),f({...e,item:c}),c}function w(e){return(0,l.m)(e,"portal-item")}async function h(e,a,t){var n,r;"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const i=e.write({},a);return await Promise.all(null!==(n=null===(r=a.resources)||void 0===r?void 0:r.pendingOperations)&&void 0!==n?n:[]),(0,d.c)(a,{errorName:"layer-write:unsupported"},t),i}function v(e){(0,s.LG)(e,s.mm.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,a,t)=>t.indexOf(e)===a)))}async function b(e,a){const{layer:t,createItemData:n,createJSONContext:i,setItemProperties:o,saveResources:l,supplementalUnsupportedErrors:s}=e;await u(e),p(e);const c=t.portalItem,d=i?i(c):w(c),y=await h(t,d,{...a,supplementalUnsupportedErrors:s}),f=await n({layer:t,layerJSON:y},c);return await(null===o||void 0===o?void 0:o(t,c)),v(c),await c.update({data:f}),(0,r.v)(d),await(null===l||void 0===l?void 0:l(c,d)),c}async function L(e,a){const{layer:t,createItemData:n,createJSONContext:i,setItemProperties:o,saveResources:l,supplementalUnsupportedErrors:s}=e;await u(e);const c=m(e),d=i?i(c):w(c),y=await h(t,d,{...a,supplementalUnsupportedErrors:s}),f=await n({layer:t,layerJSON:y},c);return await o(t,c),v(c),await async function(e,a,t){var n;const r=e.portal;await r.signIn(),await(null===(n=r.user)||void 0===n?void 0:n.addItem({item:e,data:a,folder:null===t||void 0===t?void 0:t.folder}))}(c,f,a),t.portalItem=c,(0,r.v)(d),await(null===l||void 0===l?void 0:l(c,d)),c}},11668:(e,a,t)=>{t.d(a,{K:()=>y,Q:()=>i});var n=t(67061);const r=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function i(e,a){var t;const{loadContext:r,...i}=a||{},o=r?await r.fetchServiceMetadata(e,i):await(0,n.V)(e,i);u(o),s(o);const l={serviceJSON:o};if((null!==(t=o.currentVersion)&&void 0!==t?t:0)<10.5)return l;const c="".concat(e,"/layers"),d=r?await r.fetchServiceMetadata(c,i):await(0,n.V)(c,i);return u(d),s(d),l.layersJSON={layers:d.layers,tables:d.tables},l}function o(e){const{type:a}=e;return!!a&&r.has(a)}function l(e){return"Table"===e.type}function s(e){var a,t;e.layers=null===(a=e.layers)||void 0===a?void 0:a.filter(o),e.tables=null===(t=e.tables)||void 0===t?void 0:t.filter(l)}function c(e){e.type||(e.type="Feature Layer")}function d(e){e.type||(e.type="Table")}function u(e){var a,t;null!==(a=e.layers)&&void 0!==a&&a.forEach(c),null===(t=e.tables)||void 0===t||t.forEach(d)}function y(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}},62487:(e,a,t)=>{t.d(a,{S:()=>n});const n={BingMapsLayer:async()=>(await t.e(3993).then(t.bind(t,13993))).default,BuildingSceneLayer:async()=>(await Promise.resolve().then(t.bind(t,82740))).default,CSVLayer:async()=>(await t.e(1365).then(t.bind(t,1365))).default,CatalogLayer:async()=>(await Promise.all([t.e(9122),t.e(2003),t.e(982),t.e(9078),t.e(4397)]).then(t.bind(t,84397))).default,DimensionLayer:async()=>(await t.e(126).then(t.bind(t,70126))).default,ElevationLayer:async()=>(await t.e(3875).then(t.bind(t,23875))).default,FeatureLayer:async()=>(await Promise.resolve().then(t.bind(t,38451))).default,GeoJSONLayer:async()=>(await t.e(709).then(t.bind(t,50709))).default,GeoRSSLayer:async()=>(await t.e(2551).then(t.bind(t,52551))).default,GroupLayer:async()=>(await t.e(6095).then(t.bind(t,16095))).default,ImageryLayer:async()=>(await Promise.all([t.e(9122),t.e(6333),t.e(7480),t.e(9051)]).then(t.bind(t,59051))).default,ImageryTileLayer:async()=>(await Promise.all([t.e(6333),t.e(9844),t.e(9571),t.e(7480),t.e(7416)]).then(t.bind(t,47416))).default,IntegratedMesh3DTilesLayer:async()=>(await t.e(6790).then(t.bind(t,76790))).default,IntegratedMeshLayer:async()=>(await t.e(2825).then(t.bind(t,32825))).default,KMLLayer:async()=>(await t.e(2712).then(t.bind(t,72712))).default,KnowledgeGraphLayer:async()=>(await Promise.all([t.e(7216),t.e(3620),t.e(2003),t.e(1047),t.e(4476),t.e(7118),t.e(6570)]).then(t.bind(t,26570))).default,LineOfSightLayer:async()=>(await t.e(2635).then(t.bind(t,62635))).default,LinkChartLayer:async()=>(await Promise.all([t.e(7216),t.e(3620),t.e(2003),t.e(1047),t.e(4476),t.e(7118),t.e(2218)]).then(t.bind(t,92218))).default,MapImageLayer:async()=>(await Promise.all([t.e(9122),t.e(982),t.e(5721),t.e(2951)]).then(t.bind(t,82951))).default,MapNotesLayer:async()=>(await t.e(3311).then(t.bind(t,43311))).default,MediaLayer:async()=>(await Promise.all([t.e(9639),t.e(5355)]).then(t.bind(t,46061))).default,OGCFeatureLayer:async()=>(await Promise.all([t.e(6799),t.e(5526)]).then(t.bind(t,1741))).default,OpenStreetMapLayer:async()=>(await t.e(803).then(t.bind(t,50803))).default,OrientedImageryLayer:async()=>(await t.e(2593).then(t.bind(t,52593))).default,PointCloudLayer:async()=>(await t.e(1830).then(t.bind(t,11830))).default,RouteLayer:async()=>(await Promise.all([t.e(1297),t.e(1301)]).then(t.bind(t,91301))).default,SceneLayer:async()=>(await Promise.all([t.e(3141),t.e(8320)]).then(t.bind(t,48320))).default,StreamLayer:async()=>(await t.e(4369).then(t.bind(t,84369))).default,SubtypeGroupLayer:async()=>(await t.e(9005).then(t.bind(t,69005))).default,TileLayer:async()=>(await Promise.all([t.e(9122),t.e(982),t.e(5721),t.e(1174)]).then(t.bind(t,71174))).default,UnknownLayer:async()=>(await t.e(8896).then(t.bind(t,8896))).default,UnsupportedLayer:async()=>(await t.e(2043).then(t.bind(t,72043))).default,VectorTileLayer:async()=>(await Promise.all([t.e(8376),t.e(3451)]).then(t.bind(t,53451))).default,VideoLayer:async()=>(await t.e(9398).then(t.bind(t,19398))).default,VoxelLayer:async()=>(await t.e(8560).then(t.bind(t,88560))).default,WFSLayer:async()=>(await Promise.all([t.e(1316),t.e(6964)]).then(t.bind(t,4583))).default,WMSLayer:async()=>(await t.e(2015).then(t.bind(t,52015))).default,WMTSLayer:async()=>(await t.e(1845).then(t.bind(t,1845))).default,WebTileLayer:async()=>(await t.e(4552).then(t.bind(t,24552))).default}},67061:(e,a,t)=>{t.d(a,{V:()=>r});var n=t(3825);async function r(e,a){const{data:t}=await(0,n.A)(e,{responseType:"json",query:{f:"json",...null===a||void 0===a?void 0:a.customParameters,token:null===a||void 0===a?void 0:a.apiKey}});return t}}}]);
//# sourceMappingURL=765.f2063cb4.chunk.js.map